# Module 2 - Clip 2 - Purpose Of KQL

This module will open with a brief slide that lists the purpose of KQL. It will give the Microsoft definition of the purpose, then list three bullet points:
* Explore Data and Find Patterns
* Anomalies and Outliers
* Statistical Models

From here we move into three quick demos.

## Demo Setup

** This section is setup instructions to run the demos, will not be seen in the course. **

Connect to [Azure Data Explorer Demo Site](https://dataexplorer.azure.com/clusters/help/databases/Samples):
https://dataexplorer.azure.com/clusters/help/databases/Samples

Add Cluster
https://help.kusto.windows.net 
Pick Samples database


## Demo 1 - Explore Data and Find Patterns

Exploration and Patterns

```python
let min_peak_t=datetime(2016-08-23 15:00);
let max_peak_t=datetime(2016-08-23 15:02);
demo_clustering1
  | where PreciseTimeStamp between(min_peak_t..max_peak_t)
  | evaluate autocluster()
```

Under the count column we see there are 639 rows that are contained in the pattern of eau Region, su7 ScaleUnit, DeploymentId b5d1d4df547d4a04ac15885617edba57, and ServiceHost of e7f60c5d-4944-42b3-922a-92e98a8e7dec. This pattern represents 65.74% of the rows in our data. Likewise, subsequent rows represent additional patterns.

Be aware that some rows might be represented in few (partially overlapping) patterns , and some rows are not represented in any pattern. The goal of autocluster is to transform a big table to a very small list of informative and divergent patterns, thus presenting the user significant multi-dimensional patterns for quick and efficient drill down and further investigation for the root cause.


# Demo 2 - Anomalies and Outliers

# Demo 3 - Statistical Models

Next, we'll use the statistical tools in KQL to created a moving average over time.

```python
let min_t = toscalar(demo_make_series1 | summarize min(TimeStamp));
let max_t = toscalar(demo_make_series1 | summarize max(TimeStamp));
demo_make_series1
    // Create a data series, for each OS Version sum the number of eents by date 
  | make-series NumberOfEvents=count() default=0 
             on TimeStamp 
           from min_t to max_t step 1h 
             by OsVer
    // Rendering as a timechart can make it a bit easier to digest
  | render timechart 
```

Let's say we have a series of data points over time that we want to plot on a chart. We want to smooth out our chart, so we'll create an average for each point consisting of the two data points before, the two after, and the current point.

_Place each data point on the screen as mentioned, then the average value._

The first point is 10, since there is no data before those two points will be zero as well. For this example, the next two points are 20 and 30. We add them together, getting a value of 50, divide by 5, and get an average of 12.

We then shift to the next set of five points, which are 0, 10, 20, 40, and 50, they are averaged to a value of 20 and plotted. That average is plotted and we move on through the rest of the data set. 

## Formatting Guide

The notes in this file are used during the recording of the course. It is not meant to be a word for word script, but rather the talking points used for recording.

Notes in plain text are to be used during the recording.

**Notes in bold are instructions during recording, not to be spoken.**

_Notes in italic will be used during the video editing processing._

KQL doesn't have a predefined code setting in Markdown. Use python as the closest match for multi-line code samples.

## Author Information

### Author

Robert C. Cain | [@ArcaneCode](https://twitter.com/arcanecode) | arcanecode@gmail.com

### Websites

About Me: [http://arcanecode.me](http://arcanecode.me)

Blog: [http://arcanecode.com](http://arcanecode.com)

Github: [http://arcanerepo.com](http://arcanerepo.com)

LinkedIn: [http://arcanecode.in](http://arcanecode.in)

### Copyright Notice

This document is Copyright (c) 2022 Robert C. Cain. All rights reserved.

The code samples herein is for demonstration purposes. No warranty or guarantee is implied or expressly granted.

This document may not be reproduced in whole or in part without the express written consent of the author and/or Pluralsight. Information within can be used within your own projects.

